<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator Chat</title>
    <link rel="stylesheet" href="./style.css">
    <script src="script.js"></script>
</head>
<body>
<div id="chat-container">
    <div id="chat-header">AI Image Generator</div>
    <div id="chat-messages"></div>
    <div id="input-container">
        <input type="text" id="textCommand" placeholder="Type your command..." onkeydown="handleKeyPress(event)">
        <button id="generateBtn" onclick="Texting()">Generate</button>
        <input type="file" id="imageInput" accept="image/*" onchange="SendImg(event)">
        <button id="attachImageBtn" onclick="document.getElementById('imageInput').click()">Attach Image</button>
    </div>
</div>

<script>

    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            Texting();
        }
    }

    function SendImg(event) {
        const fileInput = event.target;
        const files = fileInput.files;

        if (files.length > 0) {
            const chatMessages = document.getElementById('chat-messages');
            const userMessage = document.createElement('div');
            userMessage.className = 'message-container';
            userMessage.innerHTML = `<div class="user-message card" onclick="copyToClipboard(this)">${'User: Image Attached'}</div>`;
            chatMessages.appendChild(userMessage);

            const outputImage = document.createElement('img');
            outputImage.src = URL.createObjectURL(files[0]);
            outputImage.alt = 'Attached Image';
            userMessage.querySelector('.user-message').appendChild(outputImage);

            chatMessages.scrollTop = chatMessages.scrollHeight;

            fileInput.value = '';
        }
    }

    function Texting() {
        const chatMessages = document.getElementById('chat-messages');
        const textCommand = document.getElementById('textCommand').value;

        // Display user message
        message(textCommand || 'Generate Image', true);
        
        // Display AI message
        message(textCommand || "Generate Image", false);

        document.getElementById('textCommand').value = '';

        // Scroll to the bottom of the chat messages
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }


    function message(content, isUser) {
        const chatMessages = document.getElementById('chat-messages');
        const message = document.createElement('div');
        // append loader
        message.className = 'message-container';
        message.innerHTML = `<div class="${isUser ? 'user-message loading-img' : 'ai-message'} card" onclick="copyToClipboard(this)">${isUser ?content:'loading...'}</div>`;
        chatMessages.appendChild(message);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        // if not user message, generate image
        if (!isUser) {
            sendAndFetchResult(content)
                .then(result =>{
                    result.forEach(Url=> {
                        // delete loading text
                        message.querySelector('.ai-message').innerHTML = '';
                        const outputImage = document.createElement('img');
                        outputImage.src = Url;
                        outputImage.alt = 'Generated Image';
                        message.querySelector('.ai-message').appendChild(outputImage);});
            })
                .catch(error => console.error(error));
        };
    }



    function copyToClipboard(element) {
        const textToCopy = element.innerText;
        const tempInput = document.createElement('input');
        document.body.appendChild(tempInput);
        tempInput.value = textToCopy;
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
    }
</script>

</body>
</html>
